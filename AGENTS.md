## Purpose
This repo uses an automated “definition of done” for changes. Before declaring work complete, run the appropriate verification commands and fix any failures.

## Build output
`build/` contains compiled files generated by `npm run build`. Do not edit files under `build/` manually.

## Testing guidance
Prefer using the dummy app for tests instead of fake classes or stubbing.
Prefer functional tests over raw SQL assertions because SQL varies by database. Only assert SQL when validating a query parser, and normalize it to avoid quoting differences.
After changing base model generator logic, run `npx velocious g:base-models` from `spec/dummy` so the generated base models stay in sync.
`spec/dummy/db/structure-default.sql` is a generated schema snapshot; don't edit it manually, and commit updates when migrations/tests change it.

## Verification commands

### Quick check (fast)
Run this frequently while iterating:

1) Lint
   `npm run lint`

2) Typecheck
   `npm run typecheck`

### Normal check (full validation, slower)
Before you say the work is done, run:

1) `npm run lint`
2) `npm run typecheck`
3) `npm test`

If any command fails:
- Read the error output, fix the underlying issue, and re-run the same command.
- Repeat until the command succeeds (or clearly explain why it cannot be made to pass).

## PR description formatting
When editing PRs via CLI, use actual newlines in the body. Avoid literal `\n` sequences in the final description.

## When to run which check
- **Tiny change (docs/comments/non-functional formatting):** you may skip checks.
- **Most code changes:** run **Quick check** at least once while iterating.
- **Before final completion / ready for review:** run **Normal check**.

## Making tests faster while iterating (focus mode)

When iterating on tests, you may temporarily focus a subset of tests to speed up feedback.
This repo supports a `focus` argument on `describe` / `it` blocks:

### Focus a `describe`
```js
describe("something", {focus: true}, () => {
  // ...
})
```

### Focus an `it`
```js
describe("something", () => {
  it("sample", {focus: true}, () => {
    // ...
  })
})
```

## Pull requests
Use the `gh` CLI to open GitHub pull requests when needed.
Do not push to GitHub unless explicitly asked.

## Branches and commits
When asked to create branches and commit changes, come up with fitting branch names and commit messages. Split commits into smaller commits for each distinct change.
